---
name: 实现数字键事件处理逻辑
status: closed
created: 2025-09-06T12:07:29Z
updated: 2025-09-06T15:30:00Z
completed: 2025-09-06T15:30:00Z
github: https://github.com/Linuxdazhao/cc_auto_switch/issues/4
depends_on: [001]
parallel: false
conflicts_with: [001, 003]
last_sync: 2025-09-06T15:30:00Z
---

# Task: 实现数字键事件处理逻辑

## Description

在交互菜单的键盘事件处理中添加数字键1-9的支持，实现按下数字键后立即执行对应配置的选择和切换，无需额外确认。同时添加特殊键处理：R键选择官方配置，E键退出。

## Acceptance Criteria

- [ ] 在 `handle_full_interactive_menu()` 的事件处理循环中添加数字键支持
- [ ] 数字键1-9映射到对应位置的配置项（第1-9个配置）
- [ ] R键映射到官方配置选项
- [ ] E键映射到退出选项
- [ ] 按下数字键后立即执行选择，调用 `handle_selection_action()`
- [ ] 保持现有的方向键、回车键、Esc键功能完全不变
- [ ] 超出范围的数字键（如配置只有3个时按下7）给出合适的提示或无响应

## Technical Details

**实现方案：**
- 修改 `src/cmd/interactive.rs` 中的 `handle_full_interactive_menu()` 函数
- 在现有的 `match event::read()` 事件处理分支中添加数字键case
- 添加数字键到配置索引的映射逻辑
- 处理边界情况（超出范围的数字键）

**代码位置：**
- 文件：`src/cmd/interactive.rs`
- 函数：`handle_full_interactive_menu()` 第323-357行的事件处理部分
- 添加新的 `KeyCode::Char('1')` 到 `KeyCode::Char('9')` 分支

**关键实现细节：**
```rust
KeyCode::Char('1'..='9') => {
    let digit = code.to_digit(10).unwrap() as usize;
    if digit <= configs.len() {
        // 直接调用选择处理函数
        return handle_selection_action(configs, digit);
    }
    // 超出范围的数字键可以忽略或给出简短提示
}
KeyCode::Char('r') | KeyCode::Char('R') => {
    return handle_selection_action(configs, 0); // 官方配置
}
KeyCode::Char('e') | KeyCode::Char('E') => {
    return handle_selection_action(configs, configs.len() + 1); // 退出
}
```

## Dependencies

- [ ] 依赖任务001：数字标号显示完成
- [ ] 现有 `handle_selection_action()` 函数保持不变
- [ ] crossterm库的KeyCode事件处理

## Effort Estimate

- Size: S
- Hours: 4-6 hours
- Parallel: false (与显示逻辑有冲突，需要在001完成后进行)

## Definition of Done

- [ ] 代码实现完成：数字键1-9正确处理
- [ ] 特殊键实现：R键和E键正确映射
- [ ] 功能测试：数字键选择立即执行配置切换
- [ ] 边界测试：超出范围数字键处理正确
- [ ] 兼容性测试：现有键盘功能（方向键、回车、Esc）保持不变
- [ ] 代码质量：通过cargo clippy和rustfmt检查
