---
name: 实现分页显示和导航逻辑
status: closed
created: 2025-09-06T12:07:29Z
updated: 2025-09-06T15:30:00Z
completed: 2025-09-06T15:30:00Z
github: https://github.com/Linuxdazhao/cc_auto_switch/issues/5
depends_on: [002]
parallel: false
conflicts_with: [001, 002]
last_sync: 2025-09-06T15:30:00Z
---

# Task: 实现分页显示和导航逻辑

## Description

当配置数量超过9个时，实现分页显示功能。每页显示最多9个配置项，加上官方选项和退出选项。添加页面导航功能，支持PageUp/PageDown或N/P键翻页，并显示页面信息。

## Acceptance Criteria

- [ ] 配置数量≤9时：保持现有单页显示不变
- [ ] 配置数量>9时：自动分页，每页最多9个配置
- [ ] 显示页面信息：`第 X 页，共 Y 页`
- [ ] 添加翻页键支持：PageUp/PageDown 或 N(ext)/P(revious)
- [ ] 数字键1-9始终映射到当前页面的第1-9个配置
- [ ] 官方选项和退出选项在每页都显示
- [ ] 页面切换时保持用户友好的视觉反馈

## Technical Details

**实现方案：**
- 在 `handle_full_interactive_menu()` 函数中添加分页逻辑
- 引入页面状态变量：`current_page`, `total_pages`, `page_size = 9`
- 修改配置显示循环，只显示当前页面的配置
- 添加页面导航键盘事件处理
- 计算当前页面的配置索引范围

**核心分页算法：**
```rust
let page_size = 9;
let total_pages = (configs.len() + page_size - 1) / page_size;
let mut current_page = 0;

// 计算当前页面配置范围
let start_idx = current_page * page_size;
let end_idx = std::cmp::min(start_idx + page_size, configs.len());
let page_configs = &configs[start_idx..end_idx];

// 数字键映射到实际配置索引
let actual_config_index = start_idx + (digit - 1);
```

**代码位置：**
- 文件：`src/cmd/interactive.rs`
- 函数：`handle_full_interactive_menu()` - 需要重构部分显示和事件逻辑
- 可能需要将分页逻辑提取为辅助函数以保持代码清晰

**页面导航键处理：**
```rust
KeyCode::PageDown | KeyCode::Char('n') | KeyCode::Char('N') => {
    if current_page < total_pages - 1 {
        current_page += 1;
    }
}
KeyCode::PageUp | KeyCode::Char('p') | KeyCode::Char('P') => {
    if current_page > 0 {
        current_page -= 1;
    }
}
```

## Dependencies

- [ ] 依赖任务002：数字键事件处理完成
- [ ] 现有的配置排序和显示逻辑
- [ ] crossterm库的PageUp/PageDown事件支持

## Effort Estimate

- Size: M
- Hours: 8-12 hours
- Parallel: false (需要重构现有显示和事件处理逻辑)

## Definition of Done

- [ ] 代码实现完成：分页逻辑正确工作
- [ ] 单页场景：≤9个配置时行为与原来完全一致
- [ ] 多页场景：>9个配置时正确分页显示
- [ ] 导航功能：翻页键正确响应，页面信息正确显示
- [ ] 数字键映射：每页的数字键正确映射到对应配置
- [ ] 边界测试：第一页、最后一页的翻页处理正确
- [ ] 用户体验：页面切换流畅，信息显示清晰
- [ ] 代码质量：通过所有静态检查，代码结构清晰
